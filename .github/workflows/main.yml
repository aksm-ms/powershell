name: Testing azure sql deploy action
on:
  push:
    branches: [ mssql-test ]
    
jobs:
  build:
    runs-on: windows-latest
    steps:
    - name: Checkout code.
      uses: actions/checkout@v2 
      
#     - name: Azure login
#       uses: Azure/login@v1
#       with:
#         creds: ${{secrets.AZURE_CREDENTIALS}}
        
    - name: Run SQL script file
      uses: azure/sql-action@users/aksm/depedabot-releasesv1
#       uses: azure/sql-action@v1
      with:
        server-name: ak-sql-db-server.database.windows.net
        connection-string: ${{ secrets.SQL_CONN_STRING }}
        sql-file: ${{github.workspace}}/TestSqlFile.sql
        arguments: '-t 10'
        
    - name: Deploy SQL dacpac package
      uses: azure/sql-action@users/aksm/depedabot-releasesv1
#       uses: azure/sql-action@v1
      with:
          server-name: ak-sql-db-server.database.windows.net
          connection-string: ${{ secrets.SQL_CONN_STRING }}
          dacpac-package: ${{github.workspace}}/TestDatabaseProject.dacpac
          arguments: '/p:AllowIncompatiblePlatform=true'
